---
toc: true
title: 03|事务隔离：为什么你改了我还看不见？
date: 2022-3-13
tags: [MySQL实战45讲]
categories:
 - MySQL
# keys: 给文章加密
# 是否顶置文章
# sticky: 1
---

## 何为事务

事务是一组SQL语句，可以把事务理解为一组操作，事物的特点是**要么全部执行**，**要么全部不执行**。MySQL中，事务支持是在引擎层实现的。MySQL的原生引擎MyISAM不支持事务，而InnoDB支持事务。

## 隔离级别

隔离得越严实，效率就会越低。SQL标准得隔离级别有四种：

- 读未提交（read uncommitted，简写为RU）：一个事务还没提交时，它对数据做的更改可以被别的事务看到。

- 读提交（read committed，简写为RC）：一个事务提交之后，他对数据做的更改才能被其它事务看到。

- 可重复读（repeatable read，简写RR）：一个事务在执行过程中看到得数据，总是和这个事务在启动时看到的数据是一致的。

- 串行化（serializable，简写S）：对于同一行记录，写会加“写锁”，读会加“读锁”。当出现读写锁冲突的时候，后访问的事务必须等前一个事务执行完后，才能继续执行。

## 可重复读隔离级别的实现

1. MySQL中每条记录在更新的时候都会同时记录一条回滚操作。记录上的最新值，通过回滚操作（回滚，可以理解为git的版本控制回退），都可以得到前一个状态的值。

2. MVCC（Multi-Version Concurrency Control）：中文译为“多版本并发控制”，下面是百度百科的介绍：

> Multi-Version Concurrency Control 多版本并发控制，MVCC 是一种并发控制的方法，一般在数据库管理系统中，实现对数据库的并发访问；在编程语言中实现事务内存。

3. 长事务不仅占用大量的存储空间，而且还占用锁资源。

## 事务的启动方式

1. 利用begin或start transaction显示的启动事务，利用commit提交事务，利用rollback回滚事务。

2. set autocommit=0，会启动事务，但不会自动提交，一直会会持续到自己手动执行commit或rollback。
