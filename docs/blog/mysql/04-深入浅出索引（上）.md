---
toc: true
title: 04-深入浅出索引（上）
date: 2022-3-24
tags: [MySQL实战45讲]
categories:
 - MySQL
---

索引可以理解为一本书的目录，为了提高数据的查询效率而生。对于数据库的表而言，索引其实就是它的“目录”。实现索引的方式很多，例如采用哈希表、有序数组等数据结构，这些统称为索引模型。

## 常见的索引模型

1. 哈希表：适用于只有等值查询的场景，不适合区间查询。

2. 有序数组：查询效率高（可用二分查找，时间复杂度O(logN)），但是更新数据较慢（如果往中间插入一个值，需要挪动其他的元素），适用于静态存储引擎（即，保存的数据不会在修改了）。

3. 二叉搜索树：对于任意节点Node，它的左子树所有结点的值均小于Node的值，它的右子树所有结点的值均大于Node的值。二叉搜索树在有序数组的基础上，提高了更新数据的效率。

## N叉树

虽然二叉搜索树查询效率高，但是由于**索引不止存在于内存中，还要写到磁盘上**，例如，一颗有200万结点的平衡二叉树，树高40，一次查询可能需要访问40个数据块，如果采用N叉树，就可以降低树的高度，减少数据块的访问，提高查询效率。

## InnoDB索引模型

1. InnoDB采用B+树索引模型，**每一个索引在InnoDB里面对应一个B+树**。如果每张表对应多个索引，那么每张表对应多个B+树。

2. 主键索引的叶子节点存的是整行数据。在InnoDB中，主键索引也被称为聚簇索引（clustered index）。非主键索引的叶子结点存的是主键的值。在InnoDB中，非主键索引也被称为二级索引（secondary index）。基于非主键索引的查询需要多扫描一颗索引树，因此尽量使用主键索引来查询。

3. 页分裂：如果某数据页满了，根据B+树的算法，这个时候需要去申请一个新的数据页，然后挪动部分数据过去，这个过程称为页分裂。

4. 页合并：相邻的两个数据页由于删除数据后，利用率很低，将这两个数据页合并的过程称之为页合并。

5. 回表：先通过普通索引树查找主键的值，然后再到主键索引树执行搜索的过程。

