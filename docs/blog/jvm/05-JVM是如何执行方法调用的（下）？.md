---
toc: true
title: 05-JVM是如何执行方法调用的（下）？
date: 2022-1-23
tags: [《深入拆解Java虚拟机》]
categories:
- JVM
---

#### 虚方法调用
虚方法：可以被子类重写的方法

invokevirtual指令和invokeinterface指令均属于Java虚拟机中的虚方法调用

Java虚拟机采用了一种空间换时间的策略来实现动态绑定

Java虚拟机为每一个类生成了一张方法表，用于快速定位目标方法

<!--more-->

#### 方法表

类加载阶段除了为静态字段分配内存之外，还会构造与该类相关联的方法表

方法表本质上是一个数组，每个数组元素指向一个当前类及其祖先类中非私有的实例方法

方法表的两个特质：

- 子类方法表中包含父类方法表中的所有方法
- 子类方法在方法表中的索引值和它所重写的父类方法的索引值相同

即时编译拥有内联缓存（inlining cache）和方法内联（method inlining）两种性能更好的优化手段

#### 内联缓存

内联缓存是一种加快动态绑定的优化技术

单态（monomorphic）：仅有一种状态的情况

多态（polymorphic）：有限数量种状态的情况，二态（bimorphic）是多态的其中一种

超多态（megamorphic）：更多种状态的情况

**为了节省内存空间，Java虚拟机只采用单态内联缓存**

内联缓存附带内联二字，但它并没有内联目标方法

任何方法调用除非被内联，否则都会有固定开销

#### 参考文献

《深入拆解Java虚拟机》-郑雨迪





